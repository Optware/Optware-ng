--- libuclibc++/bin/Makefile.orig	2008-02-05 22:02:38.000000000 +0100
+++ libuclibc++/bin/Makefile	2008-02-05 23:22:46.000000000 +0100
@@ -12,38 +12,32 @@
 	$(INSTALL) -d $(PREFIX)$(UCLIBCXX_RUNTIME_BINDIR)
 	$(INSTALL) -m 755 $(WRAPPER) $(PREFIX)$(UCLIBCXX_RUNTIME_BINDIR)
 
-$(WRAPPER):
-	echo "#!/bin/bash" > $(WRAPPER)
+$(WRAPPER): Makefile
+	echo "#!/bin/sh" > $(WRAPPER)
 	echo "" >> $(WRAPPER)
 	echo 'WRAPPER_INCLUDEDIR="$${WRAPPER_INCLUDEDIR:=-I$(UCLIBCXX_RUNTIME_INCLUDEDIR)}"' >> $(WRAPPER)
 	echo 'WRAPPER_LIBDIR="$${WRAPPER_LIBDIR:=-L$(UCLIBCXX_RUNTIME_LIBDIR)}"' >> $(WRAPPER)
 	echo "" >> $(WRAPPER)
-	echo 'WRAPPER_OPTIONS=""' >> $(WRAPPER)
 	echo "WRAPPER_LIBS=\"$(LIBS)\"" >> $(WRAPPER)
 	echo "" >> $(WRAPPER)
-	echo 'WRAPPER_INCLIB="Y"' >> $(WRAPPER)
-	echo 'while [ -n "$$1" ]' >> $(WRAPPER)
-	echo 'do' >> $(WRAPPER)
-	echo '	WRAPPER_OPTIONS="$$WRAPPER_OPTIONS $$1"' >> $(WRAPPER)
-	echo '	if [ "$$1" = "-c" -o "$$1" = "-E" -o "$$1" = "-S" ]' >> $(WRAPPER)
-	echo '	then' >> $(WRAPPER)
-	echo '		WRAPPER_INCLIB="N"' >> $(WRAPPER)
-	echo '	fi' >> $(WRAPPER)
+	echo 'WRAPPER_INCLIB=$$(echo " $$@ " | sed -ne "s/.* -\([cES]\|MF\) .*/NO/p;t;aYES")' >> $(WRAPPER)
 ifneq ($(strip $(LIBS)),$(strip $(STATIC_LIBS)))
-	echo '	if [ "$$1" == "-static" ]' >> $(WRAPPER)
-	echo '	then' >> $(WRAPPER)
-	echo "		WRAPPER_LIBS=\"$(STATIC_LIBS)\"" >> $(WRAPPER)
-	echo '	fi' >> $(WRAPPER)
+	echo 'WRAPPER_STATIC=$$(echo " $$@ " | sed -ne "s/.* -static .*/YES/p;t;aNO")' >> $(WRAPPER)
+	echo 'if [ "$$WRAPPER_STATIC" = "YES" ]' >> $(WRAPPER)
+	echo 'then' >> $(WRAPPER)
+	echo "	WRAPPER_LIBS=\"$(STATIC_LIBS)\"" >> $(WRAPPER)
+	echo 'fi' >> $(WRAPPER)
 endif
-	echo '	shift' >> $(WRAPPER)
-	echo 'done' >> $(WRAPPER)
-	echo 'if [ "$$WRAPPER_INCLIB" == "Y" ]' >> $(WRAPPER)
+	echo 'if [ "$$WRAPPER_INCLIB" = "YES" ]' >> $(WRAPPER)
 	echo 'then' >> $(WRAPPER)
-	echo '	WRAPPER_OPTIONS="$$WRAPPER_OPTIONS -nodefaultlibs $$WRAPPER_LIBDIR -l$(LNAME) $$WRAPPER_LIBS"' >> $(WRAPPER)
+ifeq ($(DODEBUG),y)
+	echo '	echo $(CXX) $(GEN_CFLAGS) $(GEN_CXXFLAGS) $(EH_CXXFLAGS) $$WRAPPER_INCLUDEDIR "$$@" -nodefaultlibs $$WRAPPER_LIBDIR -l$(LNAME) $$WRAPPER_LIBS' >> $(WRAPPER)
+endif
+	echo '	exec $(CXX) $(GEN_CFLAGS) $(GEN_CXXFLAGS) $(EH_CXXFLAGS) $$WRAPPER_INCLUDEDIR "$$@" -nodefaultlibs $$WRAPPER_LIBDIR -l$(LNAME) $$WRAPPER_LIBS' >> $(WRAPPER)
 	echo 'fi' >> $(WRAPPER)
 	echo "" >> $(WRAPPER)
 ifeq ($(DODEBUG),y)
-	echo 'echo $(CXX) $(GEN_CFLAGS) $(GEN_CXXFLAGS) $(EH_CXXFLAGS) $$WRAPPER_INCLUDEDIR $$WRAPPER_OPTIONS' >> $(WRAPPER)
+	echo 'echo $(CXX) $(GEN_CFLAGS) $(GEN_CXXFLAGS) $(EH_CXXFLAGS) $$WRAPPER_INCLUDEDIR "$$@"' >> $(WRAPPER)
 endif
-	echo 'exec $(CXX) $(GEN_CFLAGS) $(GEN_CXXFLAGS) $(EH_CXXFLAGS) $$WRAPPER_INCLUDEDIR $$WRAPPER_OPTIONS' >> $(WRAPPER)
+	echo 'exec $(CXX) $(GEN_CFLAGS) $(GEN_CXXFLAGS) $(EH_CXXFLAGS) $$WRAPPER_INCLUDEDIR "$$@"' >> $(WRAPPER)
 	chmod 755 $(WRAPPER)
